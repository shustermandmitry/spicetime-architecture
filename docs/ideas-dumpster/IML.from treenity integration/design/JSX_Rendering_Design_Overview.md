# JSX Rendering Design

## Overview

The JSX rendering system in IML is responsible for converting the structured intermediate representation (IR) of
documents into dynamic, live, and reusable React components. This enables real-time updates, previews, and a seamless
authoring experience for the user.

---

## Rendering Pipeline

The rendering process consists of several stages, ensuring flexibility and scalability.

### Stage 1: Structured Input

- Input is provided as an **IML Document Tree**, generated by the Parser.
- Each node in the tree corresponds to a specific element (e.g., `$title`, `$add`, `$action`).

**Example Input Tree:**

```json
{
  "root": {
    "title": "Distributed Systems",
    "content": [
      {
        "type": "text",
        "value": "Distributed systems are essential."
      },
      {
        "type": "add",
        "value": "Scalability",
        "options": {
          "to": "Principles"
        }
      }
    ]
  }
}
```

---

### Stage 2: JSX Mapping

Each node in the Document Tree is mapped to a corresponding React or custom JSX component.

Node-to-Component Mapping:
| Node Type | React/Custom Component |
|-----------|---------------------------------|
| `title`   | `<IMLTitle>`                   |
| `text`    | `<IMLText>`                    |
| `add`     | `<IMLInteractiveBlock>`        |
| `action`  | `<IMLActionButton>`            |

**Example React Component:**

```tsx
import React from "react";

export const IMLTitle: React.FC<{ title: string }> = ({ title }) => (
  <h1 className="iml-title">{title}</h1>
);
```

---

### Stage 3: Hierarchical Rendering

The JSX components are nested to preserve the hierarchical structure of the input document.

**Example Rendered JSX:**

```jsx
<React.Fragment>
  <IMLTitle title="Distributed Systems" />
  <IMLText value="Distributed systems are essential." />
  <IMLInteractiveBlock
    value="Scalability"
    options={{ to: "Principles" }}
  />
</React.Fragment>
```

---

### Stage 4: Dynamic Updates

Utilizing React's reconciliation engine and stateful components, updates are handled in real-time:

- **Hot Reloading**: Re-renders only the affected sections of the document.
- **Stateful Elements**: Components like `<IMLActionButton>` retain user interactions (e.g., toggles, selections).

---

## Key Components in Rendering

### 1. **Document Renderer**

- Central component driving the conversion of the parsed document into React elements.
- Manages the hierarchical traversal of the document tree.

### 2. **Interactive Components**

- Components like `<IMLActionButton>` allow users to interact directly with content (e.g., triggering `$action` tasks).

**Example:**

```tsx
import React from "react";

export const IMLActionButton: React.FC<{ action: string }> = ({action}) => (
    <button onClick={() => triggerAction(action)}>{action}</button>
);
```

### 3. **Styling Engine**

- Leverages CSS modules or styled-components for consistent and customizable styling.
- Ensures layouts align with content hierarchy.

---

## Benefits of JSX Rendering

1. **Real-Time Feedback**: Changes to the IML document are immediately reflected in the UI.
2. **Customizability**: Developers can easily create new React components to handle custom tags or layouts.
3. **Performance**: React's virtual DOM ensures efficient rendering of dynamic content.
4. **Integration**: JSX output can seamlessly integrate into larger React-based applications.